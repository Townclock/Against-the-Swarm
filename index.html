<html>
<head><title> Against The Swarm </title>
<link rel="stylesheet" type="text/css" href="gui.css">
</head>

<script src="js/vue.js"></script>

<script src="js/monster.js"></script>
<script src="js/town.js"></script>
<script src="js/technology.js"></script>
<script src="js/player_inventory.js"></script>
<script src="js/gui.js"></script>
<script src="js/followers.js"></script>
<script src="js/fighter.js"></script>
<script src="js/game_logic.js"></script>
<script>
    //every variable or function that wants to be called from html has to have reference in //Vue function
    var game;
    var vm;
    window.onload = function(){
        game = new gamer();
            console.log(game);
        vm = new Vue({
            el: "#vue-div",
            data: {
                monsters: game.monsters,
                technology: game.technology,
                fighters: game.fighters,

                towns: game.towns,

                width: window.innerWidth,
                i: game.invasion_progress,
            },
            methods: {
                update: function(){
                    vm.i = game.invasion_rate;
                    vm.towns = game.towns;
                    vm.width = window.innerWidth;
                }

            }
        })
    };
    function click_fight_button(){     game.multi_fight();}
    function click_rest_button(){      game.rest();}
    function click_engage_button(){    game.engage()};
    function click_disengage_button(){ game.disengage()};
    function click_reclaim_button(){   game.reclaim()};
    console.log(game);
    var timer = setInterval(function(){
        update_ui(game.monster);

        if (!game.under_siege && !game.reclaim_mode) {
            game.increment_follower_resource();
            game.followers.followers_act(game);
            game.change_invasion_rate();
        
        }
        //code that spawns new enemy every interval
        if(!game.reclaim_mode){
            game.time_elapsed++;
            if(game.time_elapsed >= game.spawn_time && ! game.reclaim_mode){
                if (game.monsters.length < 18)
                game.monsters.push(new Monster("test", 50,10));
                game.time_elapsed = 0;
            }
        }
        console.log(game.current_town);
    }
        , 1000);

    var gui_update = setInterval(function(){
        if(!game.under_siege && !game.reclaim_mode)
            game.invasion_progress += game.invasion_rate/60;
        if (!game.reclaim_mode && game.invasion_progress > game.towns[game.current_town].location){
                game.under_siege = true;
        }
        update_ui( game.monsters[0]);
        vm.update();
    }, 17);

</script>

<body>
<div id="vue-div">

<div class="column_1" id="track_container">
    <div class="invasion_bar">


        <span style = "position:fixed" v-for="t in towns.length">

            <div v-if="!towns[towns.length-t].destroyed" class="destroyed_town" 
                 v-bind:style="{left: ((100-towns[towns.length-t].location)/100)*width*.9 - width * .02 + 'px', top:-20+'px'}"> 
                <image class="town_image" src="assets/sprites/Town.png"/> 
            </div>

            <div v-else class="destroyed_town" 
                 v-bind:style="{left: ((100-towns[towns.length-t].location)/100)*width*.9 - width * .02 + 'px', top:-20+'px'}"> 
                <image class="town_image" src="assets/sprites/Destroyed_Town.png"/> 
            </div>
        </span>
        <div class="invasion" id="invasion" style="width:0px"></div>
    </div>

            <div id="resource_display">
                    <div class="resource"><span id="follower_resource"></span></div>
                    <div class="resource"><span id="meat">0</span></div>
                    <div class="resource"><span id="scales">0</span></div>
                    <div class="resource"><span id="claws">0</span></div>

                    <div class="resource"><span id="fiber">0</span></div>
                    <div class="resource"><span id="metal">0</span></div>
                    <div class="resource"><span id="gelatin">0</span></div>

                    <div class="resource"><span id="ore">0</span></div>
                    <div class="resource"><span id="crystals">0</span></div>
            </div>

<div id="panel_track" class="column_1">
    <div class="left column_3" id="town_panel">
        <div class="panel_contents">
            <div id="resource_names">
                    <div class="resource">Followers</span></div>
                    <div class="resource">Meat</div>
                    <div class="resource">Scales</div>
                    <div class="resource">Claws</div>

                    <div class="resource">Fiber</div>
                    <div class="resource">Metal</div>
                    <div class="resource">Gelatin</div>

                    <div class="resource">Aetherium</div>
                    <div class="resource">Crystals</div>
            </div>
        </div>
    </div>
    <div id="field_panel">
    <div class="panel_contents">
        <div class="column_3 center">
            <div v-for="f in fighters" class="character_container" >
                <div v-on:click="current_fighter = m">{{f.fighter_name}} hp: {{f.hp}}</div>
                <div class="health_bar">
                    <div class="health" v-bind:style="{width: f.hp_in_percent()}"></div>
                </div>
                <image src="assets/sprites/Knight.png"/>
            </div>
            </div>



        <div class="column_3 right" id="monsters_column">
            <div v-for="m in monsters" class="character_container">
                <div v-on:click="current_monster = m">{{m.monster_name}} hp: {{m.hp}}</div>
                <div class="health_bar" id="monster_health_bar">
                    <div class="health" v-bind:style="{width: m.hp_in_percent()}"></div>
                </div>
                <image class="town_image" src="assets/sprites/Monster_Spider.png"/>
            </div>
        </div>
    </div>
    </div>
    </div>
    </div>

        <div id="control_panel">
            <div class="column_2">
                <div class="column_1">
                    <button class="button town_button" onclick="click_rest_button()">
                        "REST!"
                    </button>
                    <button class="button town_button" onclick="click_engage_button()">
                        "ENGAGE!"
                    </button>
                    <button onclick="game.hire_mage()">
                        Hire Mage
                    </button>
                </div>
                <div class="column_1">
                    <button class="button combat_button" onclick="click_disengage_button()">
                        "DISENGAGE!"
                    </button>
                    <button class="button combat_button" onclick="click_fight_button()">
                        "FIGHT!"
                    </button>
                    <button class="button  combat_button" onclick="click_reclaim_button()">
                        "RECLAIM!"
                    </button>
                </div>
            </div>
            <div class="column_2">
              <div class="column_3 right">
                <div v-for="t in technology">
                    <div v-bind:style="{color: t.is_researched_color(), visibility: t.visible(technology)}">
                      {{t.technology_name}}
                   </div>
                </div>
            </div>
            </div>
        </div>
    </div>
</div>
</body>
</html>
